<!doctype html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8" />
  <title>忘記密碼 - 毛孩到府服務平台</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./css/style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="./js/navbar-loader.js"></script>
</head>
<style>
  html,
  body {
    height: calc(100% - 56px);
  }
  main{
    padding:10rem;
  }
  .myform{
    width: 60%;
  }
</style>

<body>
  <nav id="navbar-placeholder"></nav>
  <main>
    <h1 class="text-center mymargin-1">忘記密碼</h1>
    <div class="d-flex justify-content-center align-items-center flex-column">
      <div id="message" class="text-center"></div>
      <form id="forgot-form" class="d-flex flex-column gap-2 myform">
        <input type="email" class="form-control" id="email" placeholder="請輸入您的電子郵件" required>
        <button type="submit" class="btn btn-primary">
          傳送重設密碼連結
        </button>
      </form>
    </div>
  </main>
  <footer class="fixed-bottom">
    <p>
      © 2025 毛孩到府服務平台 | 保留所有權利
    </p>
  </footer>

  <script>
    const supabase = supabase.createClient(
      "https://cbmimzpytdmtjvanvaoh.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNibWltenB5dGRtdGp2YW52YW9oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg0MjE2MzUsImV4cCI6MjA2Mzk5NzYzNX0.YHon747wNSjx6-ZcG-344tlKXtKqXxl-VYu1Vtbusgo", // ← 請替換成你的 Supabase public anon key
    );

    document
      .getElementById("forgot-form")
      .addEventListener("submit", async function (event) {
        event.preventDefault();

        const email = document.getElementById("email").value;
        const messageBox = document.getElementById("message");

        const { data, error } = await supabase.auth.resetPasswordForEmail(
          email,
          {
            redirectTo: "http://localhost:3000/reset-password.html", // ← 使用者點 Email 後跳轉頁面
          },
        );

        if (error) {
          messageBox.textContent = "錯誤：" + error.message;
          messageBox.style.color = "red";
        } else {
          messageBox.textContent = "重設密碼連結已寄送至您的信箱！";
          messageBox.style.color = "green";
        }
        messageBox.style.display = "block";
      });
  </script>
</body>

</html>